=head1 NAME

MangoModel - Simplistic Model Layer for Mango

=head1 SYNOPSIS

package MyModel;
use Mojo::Base 'MangoModel';

=head1 DESCRIPTION

L<MangoModel> is a simplistic model layer using the L<Mango> module to interact with a MongoDB backend. This class defines the overall model, including high level interaction.
Individual results, called Types inherit from L<MangoModel::Type>. 

=head1 WARNING

This code is at BEST alpha quality and anything can and will change or break. DO NOT USE IN PRODUCTION CODE!!

=head1 ATTRIBUTES

L<MangoModel> inherits all attributes from L<Mojo::Base> and implements the following new ones.

=over

=item app

An instance of a Mojolicious application. If not provided, one can be lazily created when needed. This is especially useful to have access to helpers.

=item mango

An instance of L<Mango> which acts as the database connection. If not provided, one will be lazily created using the L</uri> attribute.

=item namespace

The namespace which will be searched when looking for Types. By default, the (sub)class name of this module.

=item uri

The uri used by L<Mango> to connect to the MongoDB server.

=back

=head1 METHODS

L<MangoModel> inherits all methods from L<Mojo::Base> and implements the following new ones.

=head2 Initialization Methods

=over

=item initialize

No-op placeholder which is not called by default. This name is reserved for subclasses to define initialization functions (which it would have to call itself).

=item initialize_types

Takes a list of type names. Calls the C<initialize> method of any type names passed in or if no names are passed then for all found types.

=back

=head2 Type and Type Class Helper Methods

=over

=item all_types

Returns a list of all the types in the L</namespace>.

=item class_for

Given a type name, find the related class name, ensure that it is loaded (or else die) and return it.

=item create

 my $item = $model->create('Type');

Create an unpopulated instance of a given type. The primary reason to use this over the normal constructor is for class name resolution and proper handling of certain type attributes.

=item new_class_from_raw

Takes a class name and a hash reference. Given that the hashref which conforms to the fields needed by the type, it constructs an instance of that type. This low-level method is mostly useful for subclasses.

=item new_type_from_raw

Takes a type name and a hash reference. Given that the hashref which conforms to the fields needed by the type, it constructs an instance of that type. This low-level method is mostly useful for subclasses.

=back

=head2 Database Interaction

=over

=item find_one

Takes a type name and a query document. Given that query it performs a C<find_one> and constructs an instance of that type from the result. If no result is found then it returns a false value.

=item count

Returns the count of documents in the collection associated with a given type name.

=item drop_database

Drops the database that your L<Mango> instance points to. Obviously this method should be used with care.

=back

=head1 SEE ALSO

L<Mojolicious>, L<Mango>

=head1 SOURCE REPOSITORY

L<http://github.com/jberger/MangoModel>

=head1 AUTHOR

Joel Berger, E<lt>joel.a.berger@gmail.comE<gt>

=head1 COPYRIGHT AND LICENSE

Copyright (C) 2013 by Joel Berger

This library is free software; you can redistribute it and/or modify
it under the same terms as Perl itself.

